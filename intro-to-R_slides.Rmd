---
title: "Introduction to R"
author: "Arun Frey"
institute: "Department of Sociology, University of Oxford"
date: "07.11.2021"
output:
  xaringan::moon_reader:
    #css: xaringan-themer.css
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE, warning=FALSE}

library(xaringanthemer)
library(knitr)
library(tidyverse)
library(png)

#source("hooks.R")
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = TRUE, collapse = TRUE, cache = TRUE)

#style_mono_accent(
#  base_color = "#1c5253",
#  header_font_google = google_font("Josefin Sans"),
#  text_font_google   = google_font("Montserrat", "300", "300i"),
#  code_font_google   = google_font("Fira Mono")
#)

theme_set(theme_bw())
```


```{r out.width='100%', fig.height=6, eval=require('leaflet')}
library(leaflet)
leaflet() %>% addTiles() %>% setView(-1.264, 51.752, zoom = 17)
```

---

# What is `R`? 

- `R` is a free statistical programming software. You can download R [here](https://www.r-project.org).
- In this course, we will be running R in the [RStudio IDE](https://www.rstudio.com/products/rstudio/).

.pull-left[
    ![R](img/r-logo.png)
    ]
    
.pull-right[
    ![RStudio](img/rstudio-logo.png)
]

---

# Why `R`? 

- It's free!

--

- It's open-source!

--

- It's versatile! (In fact, all materials in this class have been created in `R`! )

---
class: center, middle

```{r, echo = FALSE, out.width = "100%"}
include_graphics("img/rstudio-screenshot.png")
```

---

# This course

- This course is designed to introduce you to the basics of `R` programming. 

- By the end, you will know how to: 

  1. Generate and transform numeric, logical, and character vectors
  
  2. Deal with missing values
  
  3. Load and inspect data
  
  4. Generate descriptives
  
---
# Using base::plot()

```{r covid, fig.show="hide"}

library(coronavirus)

corona_de <- coronavirus[coronavirus$country=="Germany" & 
                           coronavirus$type=="death", ]

corona_de$death_7 <-  zoo::rollmean(corona_de$cases, k = 7, fill = NA)

plot(x = corona_de$date, 
     y = corona_de$cases, 
     cex = 0.3)

lines(x = corona_de$date, 
     y = corona_de$death_7, 
     type = "l",
     cex = 1.5, 
     col = "red")
```

---
class: center, middle

![](`r knitr::fig_chunk("covid", "png")`)

---
# Using ggplot2::ggplot()
```{r gapminder, fig.show="hide"}
library(gapminder)

gapminder %>% 
  filter(year == "2007") %>%
  ggplot(aes(x = gdpPercap,  y = lifeExp, 
             size = pop, colour = continent)) +
  geom_point(show.legend = FALSE) +
  scale_x_log10() + 
  ggtitle("Life expectancy and GDP per capita; 2007")

```

---
class: center, middle

![](`r knitr::fig_chunk("gapminder", "png")`)


---

# Feeling stuck? 

You can use `?` whenever you want to read the documentation of a particular command. 

```{r}
# how should I specify the mean and standard deviation of a normal distribution
?rnorm
# how does a histogram work
?hist
# how does the mean() function work
?mean
```

--

The `R` community is very welcoming and inclusive. If you are feeling stuck, chances are someone has had the same issue before. 

Here are some helpful resources and great groups to join:

- <http://www.google.com>
- <http://www.r-bloggers.com>
- <http://www.stackoverflow.com>
- <https://rladies.org>

---
# If you want to dive deeper

This course only scratches the surface of what you can do in `R`. 

For more elaborate introductions and more advanced guides, see the following (free!) books: 

- [YaRrr! The Pirateâ€™s Guide to R by _Nathaniel D. Phillips](https://bookdown.org/ndphillips/YaRrr)

- [R for Data Science by Gareth Golemund and Hadley Wickham](https://r4ds.had.co.nz)

- [Advanced R by Hadley Wickham](http://adv-r.had.co.nz/Introduction.html)

---
# What we'll cover today 

## Basic programming

  1. Object types
  
  2. Vectors
  
  3. Missingness
  
  4. Subsetting 
  
  5. Matrices and dataframes
  
  6. Loading data



---
# Using RStudio

RStudio is an integrated development environment specifically developed for `R`, that lets you write code, run scripts, and view the results all in one.

-   **Source**: This is the code editor, where you write and save your code.

-   **Console**: This is where the output of your code will be printed.

-   **Environment/History**: This is where any objects, such as vectors, matrices, or dataframes, will be stored.

-   **Viewer**: This viewer previews any plots you create. You can also check your folder files and call for help here.  

---
background-image: url(https://bookdown.org/ndphillips/YaRrr/images/RStudio_Screenshot_Labels.png)
background-size: contain
---

# Using RStudio 

**Always** write code into the source code file, except for small checks and tests.

--

To execute the line of source code where the cursor currently resides you press the **Ctrl + Enter/Cmd + Enter key**, rather than pressing the Run toolbar button. 

--

Annotate your code using `#`

```{r}
# Introduction to R
# 07.09.2021

# Use head(x, n = 2) to see the first two rows of a dataframe
head(mtcars, n = 2)
```

---
# Using packages

R comes with a list of built in packages, but often you will want to use additional packages which do specific things really well. 

To do this, we have to first install the package once, and then load it whenever we would like to use it.

```{r, eval = FALSE}
# install the package (you only need to do this once)
install.packages('praise')
```

```{r}
# load the package to use its functions
library(praise)
praise()
```

---

class: inverse, center, middle

# Introducing the Basics

---
# Objects and functions

Almost everything in `R` is either an object or a function. 

- **Object**: number, vector, dataset, summary statistic, regression model, etc. 
 
- **Function**: takes objects as arguments, does something, and returns an object. 

```{r}
# Create a vector object called height
height <- c(189, 178, 166, 178, 190)

# apply the mean() function to the object height
mean(height)
```
&#8594; Thee function `mean()` takes the object `height`, calculates the average, and returns a single number. 

---
# Objects and functions

When you use `R`, you will mostly: 

1. Define objects

2. Apply functions to those objects

3. Repeat! 

---

# R as a calculator 
```{r}
3+5

10/2

sqrt(4)
```

```{r, error = TRUE}

"Hello world!"

"1" + "3"
```


---

# The `<-` operator

You can assign values to variables using the `<-` operator. You can then use the variable in subsequent operations. 

```{r}
x <- 9 + 11
x
y <- x / 2
y
```

```{r}
greetings <- "Hello world!"
greetings
```

---

# Vectors

We can create longer vectors by using `c()` (read: concatenate). 

#### Numeric vectors

```{r}
w <- 2 
y <- c(1, 2, 3)
z <- c(4, 5, 6)
z
```

#### Character vectors 

```{r}
welcome <- c("Welcome", "to", "this", "course!")
welcome 
```

---
# Vectors

For longer vectors, writing out each element can be tedious. In addition to `c()`, there are other options. 

| Function| Example|Result |
|:-------------------------|:-----------------------------|:----------|
|     `c(a, b, ...)`|    `c(1, 5, 9)` | `r c(1, 5, 9)`     |
|     `a:b`|    `1:5`| `r 1:5`    |
|     `seq(from, to, by, length.out)`|    `seq(from = 0, to = 6, by = 2)`| `r seq(from = 0, to = 6, by = 2)`     |
|     `rep(x, times, each, length.out)`|    `rep(c(7, 8), times = 2, each = 2)`| `r rep(c(7, 8), times = 2, each = 2)`     |


---
# Vector functions 

**Length**: checks the length of a vector
```{r}
x <- 2
y <- c(0.5, 45, 7, 45, 0.5)
z <- c("1 2 3 4 5 ", "6 7 8")
length(x)
length(y)
length(z)
```

--

**Sorting/unique**: sorts or displays the unique values of a vector
```{r}
sort(y)

unique(y)
```
  
---

# Summary statistics

| Function           | Example                |Result                 |
|:-------------------|:----------------------|:-----------------------|
|     `sum(x), product(x)`|    `sum(1:10)` |`r sum(1:10)`     |
|     `min(x), max(x)`|    `min(1:10)`|`r min(1:10)`    |
|     `mean(x), median(x)`|    `mean(1:10)`     | `r mean(1:10)` |
|     `sd(x), var(x), range(x)`|    `sd(1:10)` | `r sd(1:10)` |
|     `summary(x)`|    `summary(1:10)`|`Min = 1.00. 1st Qu. = 3.25, Median = 5.50, Mean = 5.50, 3rd Qu. = 7.75, Max = 10.0`     |

---

# Summary statistics 

Using these, we can easily calculate descriptive statistics for our data.

```{r}
age <- c(22, 24, 25, 21, 28, 23, 24, 27)

min(age)
sd(age)
mean(age)
```

Just like with numeric vectors, you can check the vector's length and unique values. 

```{r}
welcome <- c("Welcome", "to", "this", "course!")

length(welcome)
```

But functions designed for numeric vectors won't work. 
```{r, error = TRUE}
mean(welcome)
```

---

# Character vectors

If you look at the output of `welcome`, each word is included in separate quotation marks. 
```{r}
welcome
```

This is because `R` treats each of these words as a separate element in a vector. 

--

There are times when we might want to tell `R` to collapse the string into a single element. We can do this using the `paste()` function, specifying the option `collapse = TRUE`. 

```{r}
welcome2 <- paste(welcome, collapse = " ")
welcome2

welcome3 <- paste(welcome, collapse = "")
welcome3
```

---

# Logical vectors

While numeric vectors can include any number and character values any character string, logical vectors can only take the values of either `TRUE` or `FALSE`.

Logical vectors are therefore often used to distinguish between two groups, or select a certain subset of variables. 

--

In the example below, we create a logical vector that distinguishes between ages below and above the age of 18. 

```{r}
age <- c(14, 19, 23, 13, 16, 19, 18)

is_18 <- age >= 18
is_18

```

The vector `is_18` is `TRUE` when age is 18 or higher, and `FALSE` otherwise. 

---

# Logical operators

In the previous example we use `>=` to distinguish between ages below and above 
Some logical operators include:

| **Operator**  | **Description**           |
|---------------|---------------------------|
| `<`           | less than                 |
| `<=`          | less than or equal to     |
| `>`           | greater than              |
| `>=`          | greater than or equal to  |
| `==`          | exactly equal to          |
| `!=`          | not equal to              |
| `!x`          | Not x                     |
| `x \& y`      | x AND y                   |
| `isTRUE(x)`   |	test if X is TRUE         |


---

# Missing values 

When we deal with data in the real world, there is often lots of missingness.

Missing values are denoted with `NA`. 

They behave differently than other values. 

```{r, error = TRUE}
num_vec <- c(5, NA, 15, 20, 25, NA)
num_vec / 5

sum(num_vec)
```

--

`is.na` is a logical operation that allows us to identif missing values. 
In some functions we can specify `na.rm = TRUE` to remove missing values from the operation.

```{r}
is.na(num_vec)

sum(num_vec, na.rm = TRUE)
```

---

# A note about vectors

Vectors can include either character values or numeric values, not both! 

```{r, error = TRUE}
x <- rep(c(5, "a"), times = 2)
x

x / 2
```
With `x_num`, `R` automatically treats the vector as a character vector, because it includes some characters. 

--

If we force `R` to treat `x` as a numeric vector, it will replace all non-numeric elements with `NA`. 
```{r}
as.numeric(x)
```


---

# Exercises

1. Create the vector c(0, 5, 10, 15) in two ways: using `c()` and using `seq()`. 

2. Create a character vector of length 4 that reads c("Hello", "my", "name", is"), and save the vector under the name `my_name`.

  - Using `my_name` and the function `c()`, create a new vector `my_name2` of length 5 that ends with your name. 
  
  - Collapse `my_name2` into a string of length 1. 
  
3. Complete lessons 1, 4, and 5 in `swirl()`.

```{r, eval = FALSE}
install.packages("swirl")

library(swirl)

# Run swirl() to start the practice lessons 

swirl()
```

---

# Indexing vectors with `[]`

Often we don't want to retrieve the whole vector, but only a specific element. 

We can do this using `[]`. 

#### Numeric indexing
`a[index]`, where `a` is the vector, and `index` is a vector of index values. 
```{r}
colors <- colors()

# What is the first color? 
colors[1]

# What are the first 5 colors
colors[1:3]
```

---
# Logical indexing 

When indexing a vector with a logical index, `R` will only return values for which the index is `TRUE`. 

```{r}
years <- c(2010, 2005, 2012, 2013, 2001)

# select all years above 2010
years[years>2010]

# select all years larger than 2002 and smaller than 2013
years[years > 2002 & years < 2013]
```
--

`R` actually interprets TRUE values as 1 and FALSE values as 0. 

This allows us to quickly answer questions like: 

```{r}
#How many observations in years are greater than 2005?
sum(years > 2005)

# What's the proportion of observations in years greater than 2005
mean(years > 2005)

```

This is a really useful feature for quick calculations!


---

# Changing values of a vector 

In the example below, you know that the 4th value should have been `23`, but was wrongly coded as `NA`. 
```{r}

age <- c(17, 21, 22, 25, NA)
age[5] <- 23
age 

age[age >= 18] <- "18+"
age
```

---
# Exercises

```{r}
x <- c(5, 15, NA, 25, 30)
```

1. What elements are we subsetting? 
```{r, eval = FALSE}
x[1]
x[c(3, 4)]
x[!is.na(x)]
```

2. What is a quick way to calculate the share of missing values in x? 

--

```{r}
mean(is.na(x))
```

---

# Dataframes

Most of the work we do as sociologists will involve playing around with rectangular data or dataframes. 

While vectors are one dimensional, dataframes have two dimensions; rows and columns. 

---

# Dataframes

![](img/scalar-vector-matrix.png)

---
class: smaller

# Creating a dataframe 

You can turn multiple vectors into a dataframe using the `data.frame` command.

```{r}
# vectors
vec_name <- c("Nigeria", "Gambia", "Finland", "Brazil")
vec_year <- 2013
vec_pop_1m <- c(173.6, 1.8, 5.4, 200.4)

# combine into dataframe 
pop_df <- data.frame("country" = vec_name, 
                     "year" = vec_year, 
                     "pop_1m" = vec_pop_1m,
                     stringsAsFactors = FALSE)

pop_df
```

---
# Inspect the data

You can use various functions to inspect your dataframe. 

| Function| Description| 
|:------------------------|:-----------------------------|
|     `head(x), tail(x)`| Print the first few rows (or last few rows). | 
|     `View(x)`| Open the entire object in a new window | 
|     `nrow(x), ncol(x), dim(x)`| Count the number of rows and columns  | 
|     `rownames(), colnames(), names()`| Show the row (or column) names   | 
|     `str(x), summary(x)`| Show the structure of the dataframe (ie., dimensions and classes) and summary statistics| 

---
# Inspect the data

```{r}

dim(pop_df)

head(pop_df)

names(pop_df)

summary(pop_df)
```

---

# Load data

Rather than constructing your own dataframe, you will often work with data that already comes in a specific format, such as a csv, excel, .txt, Stata (.dta), or other file type. 

`R` can load all these different file types. 
```{r, eval = FALSE}

# csv file 
data <- read.csv(data)

# Stata file
data <- foreign::read.dta(data)

# load R data file
load("data.Rda")

```

---
class: center, inverse, middle 

# Exercises



